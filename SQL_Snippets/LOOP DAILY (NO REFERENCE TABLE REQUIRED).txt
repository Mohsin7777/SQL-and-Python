

------------ THIS IS THE WHILE LOOP
------------ IT CALCULATES THE DAY'S BASE, THEN SUBTRACTS 1 DAY FROM THE VARIABLE, AND REPEATS UNTIL IT REACHES LIMIT
------------ THE LIMIT IS DEFINED BY THE "WHILE" CLAUSE

WHILE @DAY >= GETDATE()-92             

BEGIN

INSERT INTO #DAILY_BASE
("DATE",BASE)

  SELECT @DAY , COUNT(DISTINCT(CAST(BAN AS VARCHAR(20))+SUBSCRIBER_NO)) AS BASE
  FROM #RLIVE_SERVICE
  WHERE CAST(EFFECTIVE_DATE AS DATE) <= @DAY
  AND (CAST(EXPIRATION_DATE AS DATE) > @DAY OR EXPIRATION_DATE IS NULL)
 
SET @DAY = DATEADD(DAY, -1, @DAY)
END
GO